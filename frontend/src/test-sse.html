<!DOCTYPE html>
<html>
<head>
    <title>SSE Connection Test</title>
</head>
<body>
    <h1>SSE Connection Test</h1>
    <div id="status">Connecting...</div>
    <div id="logs"></div>

    <script>
        const logs = document.getElementById('logs');
        const status = document.getElementById('status');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toISOString()}] ${message}`;
            div.style.color = type === 'error' ? 'red' : type === 'success' ? 'green' : 'black';
            logs.appendChild(div);
            console.log(message);
        }

        // Test 1: Try to connect directly to localhost:8001
        log('Test 1: Connecting directly to http://localhost:8001/sse');
        const directSource = new EventSource('http://localhost:8001/sse');

        directSource.onopen = () => {
            log('✓ Direct connection opened', 'success');
            status.textContent = 'Direct connection: OPEN';
        };

        directSource.onmessage = (event) => {
            log('✓ Direct message received: ' + event.data, 'success');
        };

        directSource.onerror = (error) => {
            log('✗ Direct connection error', 'error');
            log('ReadyState: ' + directSource.readyState, 'error');
            directSource.close();

            // Test 2: Try through proxy
            setTimeout(() => {
                log('\nTest 2: Connecting through proxy at /api/sse');
                const proxySource = new EventSource('/api/sse');

                proxySource.onopen = () => {
                    log('✓ Proxy connection opened', 'success');
                    status.textContent = 'Proxy connection: OPEN';
                };

                proxySource.onmessage = (event) => {
                    log('✓ Proxy message received: ' + event.data, 'success');
                };

                proxySource.onerror = (error) => {
                    log('✗ Proxy connection error', 'error');
                    log('ReadyState: ' + proxySource.readyState, 'error');
                };
            }, 1000);
        };
    </script>
</body>
</html>
